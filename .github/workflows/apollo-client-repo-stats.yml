name: apollo-client-repo-stats

on:
  push:
    branches:
      - main
  # schedule:
  #   - cron: "0 3 * * *"

jobs:
  apollo-client-repo-stats:
    runs-on: macos-latest
    if: github.repository == 'apollographql/team-prometheus-repo-health-cron'
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          path: main

      - name: Checkout tools repo
        uses: actions/checkout@v4
        with:
          repository: apollographql/apollo-client
          path: apollo-client

      - name: Enter apollo-client directory
        run: cd apollo-client

      - name: Run get-relative-dates.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/get-relative-dates.sh

      - name: Run get-apollo-org-members.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/get-apollo-org-members.sh
        env:
          # GH_TOKEN is a PAT with org:read scope
          GH_TOKEN: ${{ secrets.GH_TOKEN }}

      - name: Run prs-community-last-90-days.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/prs-community-last-90-days.sh

      - name: Run prs-total-merged-last-90-days.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/prs-total-merged-last-90-days.sh

      - name: Run issues-closed-last-90-days.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/issues-closed-last-90-days.sh

      - name: Run issues-percentage-replied-last-90-days.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/issues-percentage-replied-last-90-days.sh

      - name: Run prs-percentage-replied-last-90-days.sh
        run: bash ${GITHUB_WORKSPACE}/main/scripts/prs-percentage-replied-last-90-days.sh

      - run: echo $PERCENTAGE_PRS_REPLIED_TO

      # - name: Send a Slack notification
      #   uses: slackapi/slack-github-action@v1.24.0
      #   with:
      #     # Slack channel id, channel name, or user id to post message
      #     # See also: https://api.slack.com/methods/chat.postMessage#channels
      #     # You can pass in multiple channels to post to by providing
      #     # a comma-delimited list of channel IDs
      #     # channel id for #team-prometheus-repository-health
      #     channel-id: "C06EGAW8Q3F"
      #   env:
      #     SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
